# 第4章 复杂逻辑的拆解与协同

## 1 模板方法模式

- 说明：定义了一个操作中的算法骨架，但是将算法的一些步骤延迟到子类中，使得子类可以在不改变该算法结构的情况下，重新定义该算法的某些特定步骤。
- 主要优点：
    1. 封装了不变部分，扩展了可变部分
    2. 在父类中提取了公共部分的代码，便于代码复用
    3. 符合开闭原则
- 缺点：
    1. 针对每个不同的实现都需要定义一个子类，增加子类个数，提高系统实现的复杂度
    2. 父类中的抽象方法由子类实现，导致反向的控制结构，提高代码的阅读难度
    3. 如果父类需要添加新的抽象方法，所有子类都要改一遍
- 使用场景：
    1. 有多个子类共有的方法，且逻辑相同
    2. 重要的、复杂的方法
    3. 在重构时，把相同的代码抽取到父类中，并通过钩子函数约束其行为
    
## 2 Tomcat中的PipeLine机制

- Tomcat容器：Engine、Host、Context和Wrapper
- 处理流程（类似责任链模式）：
    1. 当网络请求到来时，Connector将请求包装为Request，交由Container处理，处理结果返回请求方
    2. Request在Engine容器中进行处理
    3. Engine调用PipeLine组件处理Request
    4. 每个容器中都有一个PipeLine，进行相关的处理

## 3 责任链模式

- 定义：为了避免请求发送者与多个请求处理者耦合在一起，将所有请求的处理者通过前一对象记住其下一个对象的引用而连成一条链，当有请求发生时，可将请求沿着这条链传递，直到有对象处理它为止。
- 优点：
    1. 降低了对象之间的耦合度
    2. 增强了系统的可扩展性
    3. 增强了给对象指派职责的灵活性
    4. 简化了对象之间的连接
    5. 责任分担
    
## 4 for循环和单向链表驱动

### 4.1 for循环

- 优点：
    1. 实现比较简单，逻辑清晰
    2. 用户不关注执行顺序，由上层容器统一调度
    3. 关注点单一，偏重考虑当前节点的实现，不考虑与其他节点的关系
- 适用场景：
    1. PostProcessor机制
    2. 事件发布与通知机制
    
### 4.2 单向链表
- 优点：
    1. 控制能力强，在执行链上快速地前后移动，并控制后续节点是否执行
    2. 栈式调用，方便获取下一个逻辑点的处理结果，并在当前函数中使用
- 适用场景：
    1. 缓存
    2. 限流