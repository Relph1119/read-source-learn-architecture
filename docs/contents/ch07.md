# 第7章 事件的分散性与协议化封装

## 1 监听机制

- 事件监听：轮询查看、主动通知或广播
- 观察者模式：包含有依赖关系的观察者和主题两个角色，多个观察者同时观察一个主题，两者只通过抽象接口保持松耦合状态
- 常见事件监听的主要角色：
    1. 事件：事件源发生某事件是特定的事件监听器被触发的原因
    2. 事件监听器：监听特定事件，并在内部定义了事件发生后的响应逻辑
    3. 事件发布器：事件监听器的容器，对外提供发布事件和增删事件监听器的接口，维护事件和事件监听器之间的映射关系，并在发生事件时负责通知相关的事件监听器
- 与PostProcessor扩展的区别： 
    1. PostProcessor偏重逻辑的扩展，使主流程适应各种场景的处理和个性化需求，可能会影响主流程的程序流走向
    2. 事件监听机制仅仅对主流程不同状态与事件的感知，并实现逻辑增强，不会影响主流程

## 2 WebSocket

- 与HTTP的不同点：
    1. WebSocket是一种双向通信协议，建立连接后，服务器和浏览器都能主动向对方发送或接收数据
    2. WebSocket需要类似TCP协议的握手连接，连接成功后才能通信
- WebSock构建时的事件协议化模式
    1. 以生命周期为维度，抽象出服务在不同阶段的事件定义，并整合为协议骨架
    2. 客户端在对接时，依赖预定义好的协议模板将进行个性化内容对接
    3. 建立服务器与客户端的专属通道，每个通道传递对应的事件类型并进行分发
- 好处：
    1. 事件的定义规范化
    2. 事件模板化覆盖整个生命周期，只需一次对接
    3. 客户端与服务器之间以特定需求建立通道，避免相互影响以及入侵